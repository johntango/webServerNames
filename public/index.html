<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Name Collector</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600&display=swap");

      :root {
        --bg: #0f172a;
        --card: rgba(15, 23, 42, 0.8);
        --accent: #f97316;
        --accent-muted: rgba(249, 115, 22, 0.18);
        --text: #e2e8f0;
        --muted: #94a3b8;
        --border: rgba(148, 163, 184, 0.35);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Space Grotesk", "Segoe UI", system-ui, -apple-system,
          sans-serif;
        background: radial-gradient(
          circle at top,
          #1d4ed8 0%,
          #0f172a 45%,
          #020617 100%
        );
        color: var(--text);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
      }

      .shell {
        width: min(900px, 100%);
        backdrop-filter: blur(18px);
        border-radius: 32px;
        border: 1px solid var(--border);
        padding: 2rem;
        background-color: var(--card);
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.35);
        display: grid;
        gap: 2rem;
      }

      h1 {
        margin: 0;
        font-size: clamp(1.8rem, 3vw, 2.4rem);
      }

      p {
        margin: 0.25rem 0 0;
        color: var(--muted);
      }

      form {
        display: grid;
        gap: 1rem;
      }

      label {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        font-weight: 600;
        letter-spacing: 0.02em;
      }

      input {
        padding: 0.85rem 1rem;
        border-radius: 14px;
        border: 1px solid var(--border);
        background-color: rgba(15, 23, 42, 0.7);
        color: var(--text);
        font-size: 1rem;
        transition: border-color 150ms ease, transform 150ms ease;
      }

      input:focus {
        outline: none;
        border-color: var(--accent);
        transform: translateY(-1px);
      }

      .actions {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      button {
        flex: 1;
        min-width: 140px;
        border: none;
        border-radius: 999px;
        padding: 0.95rem 1.4rem;
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.02em;
        cursor: pointer;
        transition: transform 150ms ease, box-shadow 150ms ease;
      }

      button.primary {
        background: linear-gradient(120deg, var(--accent), #fb923c);
        color: #0f172a;
        box-shadow: 0 12px 30px rgba(249, 115, 22, 0.35);
      }

      button.secondary {
        background: var(--accent-muted);
        color: var(--accent);
        border: 1px solid rgba(249, 115, 22, 0.4);
      }

      button:active {
        transform: translateY(1px);
      }

      .status {
        min-height: 1.25rem;
        font-size: 0.95rem;
      }

      .entries {
        background: rgba(2, 6, 23, 0.35);
        border-radius: 20px;
        border: 1px solid var(--border);
        padding: 1.5rem;
        max-height: 280px;
        overflow-y: auto;
      }

      .entry {
        padding: 1rem;
        border-radius: 14px;
        border: 1px solid rgba(148, 163, 184, 0.25);
        background: rgba(15, 23, 42, 0.6);
        display: grid;
        gap: 0.3rem;
      }

      .entry + .entry {
        margin-top: 0.8rem;
      }

      .entry small {
        color: var(--muted);
        letter-spacing: 0.02em;
      }

      @media (max-width: 640px) {
        .shell {
          padding: 1.5rem;
        }

        .actions {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <main class="shell">
      <header>
        <h1>Guest Credentials Console</h1>
        <p>Submit entries and pull the live roster kept on the server.</p>
      </header>

      <form id="entry-form">
        <label>
          Name
          <input id="name" name="name" autocomplete="name" required />
        </label>
        <label>
          Email
          <input
            id="email"
            type="email"
            name="email"
            autocomplete="email"
            required
          />
        </label>
        <label>
          Password
          <input
            id="password"
            type="password"
            name="password"
            autocomplete="new-password"
            required
          />
        </label>
        <div class="actions">
          <button class="primary" type="submit">Record Entry</button>
          <button class="secondary" type="button" id="view-list">
            Load Entries
          </button>
        </div>
        <div class="status" id="status"></div>
      </form>

      <section class="entries" id="entries" aria-live="polite">
        <p class="placeholder">No entries fetched yet.</p>
      </section>
    </main>

    <script>
      const form = document.getElementById("entry-form");
      const statusEl = document.getElementById("status");
      const entriesEl = document.getElementById("entries");
      const viewBtn = document.getElementById("view-list");

      const renderEntries = (entries) => {
        if (!entries.length) {
          entriesEl.innerHTML =
            '<p class="placeholder">No entries stored yet.</p>';
          return;
        }

        entriesEl.innerHTML = entries
          .map(
            (entry) => `
            <article class="entry">
              <strong>${entry.name}</strong>
              <div>${entry.email}</div>
              <small>Saved at ${new Date(
                entry.createdAt
              ).toLocaleString()}</small>
            </article>
          `
          )
          .join("");
      };

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        statusEl.textContent = "Sending...";

        const payload = {
          name: form.name.value,
          email: form.email.value,
          password: form.password.value,
        };

        try {
          const response = await fetch("/api/entries", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || "Unable to record entry");
          }

          form.reset();
          statusEl.textContent = "Entry stored successfully.";
        } catch (error) {
          statusEl.textContent = error.message;
        }
      });

      viewBtn.addEventListener("click", async () => {
        viewBtn.disabled = true;
        statusEl.textContent = "Loading roster...";

        try {
          const response = await fetch("/api/entries");
          const data = await response.json();
          renderEntries(data.entries || []);
          statusEl.textContent = "Roster updated.";
        } catch (error) {
          statusEl.textContent = "Unable to fetch entries.";
        } finally {
          viewBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
